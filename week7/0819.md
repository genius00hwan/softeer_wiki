# 20250819
## 오늘 한 일
api 오류 수정
- 회원 비활성화 경우
- 토큰 만료시간 관리
- 기록지,리포트 상태 전이 문제 해결
- 프로필 Url이 없는 사용자의 기록지를 조회할 때 문제 해결

에러 처리 세분화

## 배운 점/ 느낀 점
오늘은 하루종일 api 오류 수정, fe의 요구사항 반영을 반복했다.

요구사항 반영 -> 로직 틀어짐 -> api 오류 -> 수정 
이 작업이 반복 됐다. 

예를 들어, 프로필 url을 바로 presigned url로 바꿔서 응답하게 하면서 vo에서 npe가 생기고, 이걸 다시 고치고. 또, 생성 완료된 기록지 수정이 가능해야 하면서 upsert 로직을 수정하고, 리포트로 자동생성 되어 기록지로서 조회되지 않는 문제등을 해결하면서 시간을 보냈다. 비동기 로직은 제대로 시작도 못했는데 큰일이다.

함수 하나 고치면 된다고 안일하게 생각한게 문제다. 뭐하나 고칠때, 충분히 고려하지 않고 일단 요구사항부터 반영하려고 고치다 보니 연쇄적으로 발생하는 문제들을 파악하지 못했다. 또, 최대한 figma와 기획 설명을 보면서 적확한 api를 설계 하려고 했지만, 놓치는 부분들이 생겼고, 다시 수정하는 일이 생겼다. 팀원이 없어서 가장 걱정했던 부분이 이런 세세함인데 우려했던 일이 발생한 것이다... 

1. 혼자일수록 더 꼼꼼해야 했다. 백엔드 로직을 다 책임져야 하므로 신경을 더 썼어야 했는데..
2. 팀원이 혼자여서 코드리뷰를 받지 못한다.(_개인 레포에 포크를 따서라도 coderabbit 연결해서 리뷰를 받았어야 했는데.. 정말 후회되는 부분이다._)

지금이라도 개인레포에 포크를 딸지.. 내일 dangle과 이야기 해봐야 겠다.


스스로 칭찬하고 싶은 점은 엔티티 upsert 과정에서 생성이 안돼서 생기는 오류들에 대한 점이다. 생성이 되면 안되는데 되는것 보다는 되야 하는데 안돼서 생기는 오류를 잡는게 낫다고 생각한다. 물론, 500에러는 나면 안되는 것이다. 그래도 유니크 제약 조건등의 엔티티 제약은 잘 해놓은것 같다.

또, 로깅 세팅을 잘 해놔서, 오류를 찾는데 시간이 오래 소모되지는 않았다. 로그를(gpt랑) 뜯어보다 보면 금방 잘못된 부분을 찾을 수 있었다. 

비즈니스 로직상의 예외를 커스텀해서 응답을 주고 있었다. 그러다 보니 fe에서 어떤 api에서 어떤 상황에 어떤 예외응답이 오는 지 알려주어 빠르게 접수할 수 있게 되었다.

또, 서버 예외 처리를 세분화 했다. dto 바인딩 오류같은 경우 에러 원인을 명확히 알려주지 못했는데 이 부분을 보강해서 api연동에 도움을 주고자 했다. 앞으로 도움이 될지는 두고보자!
